# 🛡️ ResNet分类加壳恶意软件
![](https://img.shields.io/badge/license-Apache2.0-green)

本项目提供了一个能快速定位软件加固的作用位置并具有较高可信度的检测方法。目前已经实现加固判断二分类，且在结果具有较高可靠性的基础上提供了创建加固类型判断多分类的条件。

## 📋 项目简介

本项目旨在着眼于常见免杀机制规避检测手段的重点/隐匿作用点，通过摆脱一般的检测恶意代码作用区段，检测“非恶意”代码段/混淆段来对数种加固规避机制进行测试。通过这种方式，本项目在一定程度上降低研究人员在面对加固样本的分析难度。

使用了ResNet，SIFT与ORB

## ⚙️ 工具/环境

使用的加壳工具：VMProtect/ The Mida v3
其他工具：Ghidra/ IDA Pro/ Winhex
硬件：
    Intel i7-9750H @2.60GHz 6 Core
    Nvidia Geforce 1660Ti 6G（Tensor computeCapability：7.5）
    Memory: 16.0GB 2666MHz
    Windows 11 Dev preview
软件：
    PyCharm 2021.1 (Community Edition)
    Python 3.9.1 (For sample analysis 样本预处理)
    Python 3.8.8 (For Tensorflow 模型搭建与测试)
    Tensorflow 2.4.1 (GPU)
    CUDA 11.3.0_456.89
    cudnn 11.2v8.1.1.33

## 🚀 预处理步骤
1. python3 Convert_file2image.py    文件转为图片
2. python3 gray2rgb.py              转为rgb图片
3. python3 cutimage_bat.py          批量剪裁
4. python3 delete_same_image.py     去重

## 🤖 注意事项

- 在对"train.py"与"model.py"文件进行编辑时，已经在使用者可能需要根据情况进行更改的区域进行了中文标注，当运行出现以下错误时，请根据下列说明进行修正。
  1. 提示显存溢出/ 内存分配空间不足(OOM)：
    - 确认分类器的label数量是否对应tf.keras.Sequential中的Dense数值；
    - 确认batch_size大小是否处于当前主机的显卡压力范围内，如样本集大小超出显存负荷，尝试缩小图像，并换用CPU进行运算；
  2. 提示无法找到dataset：
    - 确认目标路径中已经包含数据集（默认为"dataset"）并检查文件夹名是否对应；
  3. 提示类型错误无法正常计算：
    - 检查需要输入数值的部分是否仍保留引号，尤其在是报错提示为"str cannot be..."的情况下；
  4. 提示载入resnet34/ resnet50/ resnet101时的错误：
    - 检查头部引用时是否正确引用，并适当减小model.py文件内的def定义模型参数数值；

本项目中可以在训练完第一轮并在指定路径生成权重文件后随时终止（一般情况下第一轮所得权重参考价值较低），并将权重文件进行迁移学习使用。

## 🙏 贡献者

- funkpopo ([@funkpopo](https://github.com/funkpopo))

## 📜 许可证

本项目采用 Apache-2.0 license 许可证进行授权，详见 LICENSE 文件。
